# Memory — SAVE

Save a session note, decision, or context to the repository memory bank.

**Purpose:** Capture important information for future reference and team knowledge sharing.

---

## Critical Path Policy

**Repository Root Requirement:**
- Memory bank MUST be at repository root: `.github/memory-bank/`
- Always use `git rev-parse --show-toplevel` to find repository root first
- NEVER create memory banks in subdirectories or packages

### Correct vs Incorrect Paths
✅ **Correct**: `[ROOT]/.github/memory-bank/[branch]/sessions/` (where ROOT = `git rev-parse --show-toplevel`)  
❌ **Wrong**: `./memory-bank/sessions/` (current directory)  
❌ **Wrong**: `packages/app/.github/memory-bank/` (subdirectory)

---

## Branch Slug Calculation

Use `branchSlug` (not raw branch name) for folder paths:

**Calculation Steps:**
1. Get current branch: `git branch --show-current`
2. Replace `/` and `\\` with `-`
3. Replace any non-alphanumeric (except `-`) with `-`
4. Collapse multiple `-` into one
5. Trim leading/trailing `-`
6. If branch cannot be determined, use `unknown-branch`

**Examples:**
- `feature/user-auth` → `feature-user-auth`
- `bugfix/TICKET-123` → `bugfix-TICKET-123`
- `main` → `main`

---

## Save Workflow

### 1. Capture Context Information

**Get repository root:**
```bash
git rev-parse --show-toplevel
```

**Get current context:**
```bash
# Current branch
git branch --show-current

# Current date and time
date +%Y-%m-%d
date +%H:%M:%S

# Last commit
git log -1 --oneline

# Working directory status
git status --short
```

---

### 2. Determine Storage Location

**Calculate paths:**
```bash
ROOT=$(git rev-parse --show-toplevel)
BRANCH=$(git branch --show-current)
# Calculate branchSlug (apply transformation rules)
DATE=$(date +%Y-%m-%d)

# Storage path
MEMORY_PATH="$ROOT/.github/memory-bank/[branchSlug]/sessions"
```

**Ensure directory exists:**
```bash
mkdir -p $MEMORY_PATH
```

---

### 3. Generate Filename

**Naming Convention:**

**With Ticket ID (if branch matches pattern `[A-Z]+-[0-9]+`):**
```
[TICKET-ID]-[YYYY-MM-DD]-[description].md
```
Example: `TICKET-123-2026-02-13-authentication-fix.md`

**Without Ticket ID:**
```
[branchSlug]-[YYYY-MM-DD]-[description].md
```
Example: `feature-user-auth-2026-02-13-session-notes.md`

**Description Guidelines:**
- Use lowercase
- Replace spaces with hyphens
- Keep under 50 characters
- Be descriptive but concise

---

### 4. Create Memory Document

**Ask user for:**
1. **Title**: Short descriptive title (required)
2. **Body**: Detailed notes, decisions, or context (required)

**Document Template:**
```markdown
# [Title]

**Date:** [YYYY-MM-DD]  
**Time:** [HH:MM:SS]  
**Branch:** [branch name]  
**Last Commit:** [git log -1 --oneline]  
**Status:** [git status summary]

---

## Context

[User-provided body content]

---

## Related

- **Files Changed:** [list from git status]
- **Commits:** [recent relevant commits]
- **References:** [links to related memories, tickets, documentation]

---

*Generated by RIPER Memory Save*
```

---

### 5. Write and Commit

**Write file:**
```bash
# Write content to file
echo "[markdown content]" > $MEMORY_PATH/[filename].md
```

**Commit to repository:**
```bash
cd $ROOT
git add .github/memory-bank/[branchSlug]/sessions/[filename].md
git commit -m "memory: save session notes for [branchSlug]"
```

---

## Types of Memories to Save

### Session Notes
- **When:** End of work session
- **Content:** Progress, blockers, next steps
- **Purpose:** Context for resuming work

### Decisions
- **When:** After architectural or implementation decision
- **Content:** Options considered, rationale, chosen approach
- **Purpose:** Document why decisions were made

### Discoveries
- **When:** Found solution to tricky problem
- **Content:** Problem description, solution, lessons learned
- **Purpose:** Knowledge sharing and future reference

### Warnings
- **When:** Encountered gotcha or anti-pattern
- **Content:** What went wrong, how to avoid
- **Purpose:** Prevent future mistakes

### Context Capture
- **When:** Complex investigation or research
- **Content:** Findings, references, key insights
- **Purpose:** Preserve research for team

---

## Example Usage

**Scenario:** End of debugging session

**Context Captured:**
```bash
git rev-parse --show-toplevel
# Output: /home/user/projects/myapp

git branch --show-current
# Output: bugfix/TICKET-456

date +%Y-%m-%d
# Output: 2026-02-13

git log -1 --oneline
# Output: abc1234 Fix null pointer in auth service

git status --short
# Output: M src/auth/AuthService.cs
```

**Calculated:**
- branchSlug: `bugfix-TICKET-456`
- Filename: `TICKET-456-2026-02-13-null-pointer-fix.md`
- Path: `/home/user/projects/myapp/.github/memory-bank/bugfix-TICKET-456/sessions/TICKET-456-2026-02-13-null-pointer-fix.md`

**Memory Content:**
```markdown
# Null Pointer Fix in Auth Service

**Date:** 2026-02-13  
**Time:** 14:30:00  
**Branch:** bugfix/TICKET-456  
**Last Commit:** abc1234 Fix null pointer in auth service  
**Status:** Modified: src/auth/AuthService.cs

---

## Context

Fixed null pointer exception in AuthService when user token is expired.

**Root Cause:**
- TokenValidator was returning null instead of ValidationResult
- AuthService didn't check for null before accessing properties

**Solution:**
- Added null check with early return
- TokenValidator now returns ValidationResult.Invalid() instead of null
- Added unit tests for expired token scenario

**Testing:**
- Manual test: ✅ Expired token now returns 401
- Unit tests: ✅ All passing
- Integration tests: ✅ Auth flow works end-to-end

---

## Related

- **Files Changed:** src/auth/AuthService.cs, src/auth/TokenValidator.cs, tests/AuthServiceTests.cs
- **Commits:** abc1234 Fix null pointer in auth service
- **References:** [TICKET-456](link), [#authentication-fix PR](#)

---

*Generated by RIPER Memory Save*
```

---

## Usage Tips

- **Save frequently:** Capture context before switching tasks
- **Be descriptive:** Future you won't remember everything
- **Include references:** Link to tickets, PRs, files, commits
- **Group related notes:** Use consistent naming for multi-session work
- **Commit memories:** Commit to git so team can see and share knowledge

---

**Memories preserve valuable context that would otherwise be lost between sessions.**
